<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello Deer by DAPP</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; overflow: hidden; }
        #map { height: 100vh; width: 100vw; }
        
        /* The Crosshairs */
        #crosshair {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2000; pointer-events: none;
            display: none; /* Only show during reporting */
        }
        .crosshair-line { position: absolute; background: rgba(255, 0, 0, 0.6); }
        .h-line { width: 40px; height: 2px; left: -20px; top: -1px; }
        .v-line { width: 2px; height: 40px; top: -20px; left: -1px; }
        .center-dot { width: 4px; height: 4px; background: red; border-radius: 50%; position: absolute; top: -2px; left: -2px; }

        .ui-panel {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 3000; background: white; padding: 15px; border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); width: 90%; max-width: 400px;
        }
        .btn-report { background: #2d5a27; color: white; border: none; padding: 12px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; }
        #report-form { display: none; }
        .counter-row { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
        .instr { font-size: 0.8rem; color: #666; margin-bottom: 10px; text-align: center; }
    </style>
</head>
<body>

<div id="map"></div>

<div id="crosshair">
    <div class="crosshair-line h-line"></div>
    <div class="crosshair-line v-line"></div>
    <div class="center-dot"></div>
</div>

<div class="ui-panel">
    <div id="main-ui">
        <button class="btn-report" onclick="startReporting()">+ Report Sighting</button>
    </div>

    <div id="report-form">
        <div class="instr">üìç Pan map to place deer under crosshairs</div>
        <div class="counter-row"><span>Stags (Male)</span><button onclick="change('m', 1)">+ <span id="m-count">0</span></button></div>
        <div class="counter-row"><span>Hinds (Female)</span><button onclick="change('f', 1)">+ <span id="f-count">0</span></button></div>
        <div class="counter-row"><span>Calves (Babies)</span><button onclick="change('b', 1)">+ <span id="b-count">0</span></button></div>
        <button class="btn-report" onclick="submitSighting()" style="background: #e67e22; margin-top:10px;">Confirm & Report</button>
        <button onclick="cancelReporting()" style="width:100%; background:none; border:none; color:#666; margin-top:8px; cursor:pointer;">Cancel</button>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const map = L.map('map').setView([51.442, -0.285], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    let counts = { m: 0, f: 0, b: 0 };

    function startReporting() {
        document.getElementById('main-ui').style.display = 'none';
        document.getElementById('report-form').style.display = 'block';
        document.getElementById('crosshair').style.display = 'block';
        map.setZoom(17); // Zoom in for precision
    }

    function cancelReporting() {
        document.getElementById('main-ui').style.display = 'block';
        document.getElementById('report-form').style.display = 'none';
        document.getElementById('crosshair').style.display = 'none';
        counts = { m: 0, f: 0, b: 0 };
        document.querySelectorAll('[id$="-count"]').forEach(el => el.innerText = 0);
    }

    function submitSighting() {
        const preciseCoords = map.getCenter();
        const total = counts.m + counts.f + counts.b;
        
        // Simulating the backend: Precise to Rangers, Fuzzy to Public
        console.log(`SENT TO RANGERS: ${total} deer at [${preciseCoords.lat}, ${preciseCoords.lng}]`);
        
        alert(`Success! Precise location recorded for Rangers.\nHeatmap updated with fuzzy location.\n\nThank you!`);
        cancelReporting();
    }

    function change(type, delta) {
        counts[type] += delta;
        document.getElementById(type + '-count').innerText = counts[type];
    }
</script>
</body>
</html>
