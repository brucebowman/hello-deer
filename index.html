<script>
    const map = L.map('map').setView([51.442, -0.285], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // FUZZY HEATMAP: Increased radius and blur to obscure exact locations
    // Data format: [Lat, Lng, Intensity]
    const heat = L.heatLayer([
        [51.446, -0.288, 0.5], [51.435, -0.282, 0.5], [51.442, -0.275, 0.4]
    ], {
        radius: 40,  // Makes the "glow" larger
        blur: 25,    // Softens the edges so you can't see the center point
        maxZoom: 15  // Disappears if you zoom in too close (prevents sniping)
    }).addTo(map);

    let counts = { m: 0, f: 0, b: 0 };
    
    function submitSighting() {
        // In a real app, we'd call the what3words API here.
        // For the prototype, we simulate the 'Ranger-only' precise data:
        const total = counts.m + counts.f + counts.b;
        
        // This simulates what the database (and the Rangers) would see
        console.log("RANGER LOG: Sighting at ///filled.count.soap - Count: " + total);

        alert(`Success! Your sighting is now part of the general heatmap.\n\nThank you for keeping Richmond Park safe!`);
        
        hideReporting();
        counts = { m: 0, f: 0, b: 0 };
        document.querySelectorAll('[id$="-count"]').forEach(el => el.innerText = 0);
    }

    // February 2026 Fact Rotation
    const facts = [
        "Feb 2026: Male deer are currently shedding antlers. If you see one with missing antlers, it's natural!",
        "Safety Tip: 50 meters is roughly the length of 4 double-decker buses.",
        "Cull Notice: Pedestrian gates lock at 20:00 tonight. Don't get locked in!"
    ];
    document.getElementById('fact-of-the-day').innerHTML = `<b>Pro Tip:</b> ${facts[Math.floor(Math.random() * facts.length)]}`;
</script>
